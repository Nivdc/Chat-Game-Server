# 简介
这是lobby的sc2mafia游戏包

## 已知问题

### 后端问题
* 在流程控制上还不太完善，在所有玩家中途退出后，游戏仍然需要等到下一个victoryCheck()函数运行时才能完全终止。

### 前端问题
* 如果你切换窗口，可能会导致计时器的显示不正确，比如说切出去搞点事再切回来，可能实际上就剩20秒投票了，还是会给你显示60秒。  
* 前端的阶段计时器似乎有小于一秒钟的误差，我认为这是可以接受的，可以做点动画掩盖一下，记录一下。  
* 不能保证夜间行动时所有玩家在同一时间观看同一动画，因为每个动画的播放时间不一样，每个人的动画队列也不一样。这不是一个bug，也不会影响游戏性，但还是记录一下。  
* 夜晚行动阶段有一个偶发性bug，页面背景会屏闪一下...完全没道理啊...有可能是新加入的计时器的问题  

## 计划中的功能
### 前后端功能
* 添加狼人杀的角色和机制  
* 添加塞勒姆镇的角色和机制  
* 添加血染钟楼的角色和机制
* 添加图片发送支持（表情包必须有，但显示最好别太大）  
* 添加语音麦克风支持  
* 嘿，为什么不顺便把视频也支持一下呢？干脆再加个直播？  
* 给社恐添加个自爆按钮

### 后端功能
我理想中的设计是游戏中存在四种结构：  
1. Faction
    - PlayerGroup，由多个玩家组成的集合
    - 一个胜利目标
2. Team
    - PlayerGroup
    - 可以从属于某个Faction
    - 可以有ability
    - 可以有自己的胜利目标
3. Player
    - 可以从属于某个Faction
    - 可以从属于某个Team
4. Role
    - 可以有一个默认从属的defaultFaction，如果没有这个defaultFaction，则必须要有自己的胜利目标（中立角色）
    - 可以有ability
    - 可以有自己的胜利目标

* Faction、Team、RoleMate的胜利目标任意两个（或一个）空缺都是可以的，但是每个玩家必定有一个胜利目标
* 游戏的主循环终止于某个Faction达成胜利目标（或所有Faction已无人生还），然后依次结算每个玩家的Faction、Team、Role胜利目标，所有目标皆达成的玩家胜出。

### 前端功能
* 为游戏接入中文网字计划提供的多种字体  
* 推出一个屏蔽动画及音效的选项（妈的各种闪光看得我癫痫都要发作了  
* 引入功能更丰富的less.js重制页面的css  
* 一个更模块化的前端，也许会迁移到功能更多的框架  
* 移动端适配  
* 利用Web Speech API制作一个更拟人的导演（主持人  

### 全局自定义功能
* 白日密会：所有在晚上可聊天的角色，在白天也可以互相秘密交谈  
* 无差别杀人：所有可杀人角色可以选择随机杀人（可以选择是否包含自身和盟友  
* 秘密效忠：城镇看情况不对，可以直接跳反当二五仔  
* 添加一个道具系统：每隔一段时间玩家可以获取一些功能性道具？比如手枪、防弹衣、调查档案什么的？我有了个特别好玩的想法：一个C4炸弹，拥有它的人可以安装在别人身上，然后自己设置一个密码。一段时间过后炸弹爆炸，除非能在结束前输入密码。 
* 被无罪释放的人不能再被投上台。  
* 添加一个地点规则集来引入更丰富的机制和功能。（变成《Space Station 13》了？）  
* 夜间投票：可以停止一个角色的行为（搭配城镇黑手无致命板子）  
* 反转投票：白天实名投票封禁一个玩家的行为，晚上匿名投票杀死一个玩家。  
* 双生投票：白天投票实名处刑，晚上匿名投票处刑。  

### 阵营与团队自定义功能
#### 城镇
* 保卫市民模式：如果市民全部死亡，城镇失败（这个已经做出来了，稍后需要放到一个更合理的位置）  

#### 黑手党
* 谋定而后动：黑手党可以选择首夜不杀人，第二晚双杀（仅限第二晚  
* 民主帮派：教父没有额外投票权  
