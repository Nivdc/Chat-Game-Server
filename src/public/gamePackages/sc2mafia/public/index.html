<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>sc2mafia</title>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" type="text/css">
        <link href="index.css" rel="stylesheet" type="text/css">
        <script defer src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.14.0/cdn.min.js"></script>
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script> -->
        <script src="index.js"></script>
    </head>

    <body x-data="game">
        <div id="loading" x-show="loading"><i class="fa-solid fa-spinner"></i> 加载中...</div>

        <div id="settingPage">
            <div id="settingPageTopBar">
                <!-- 游戏设置项 -->
                <div id="settingForm" class="border">
                    <h3 class="boxLabel">游戏设置</h3>
                    <div>
                        <h4>游戏性设置</h4>
                        <div>
                            <span>游戏开始于</span>
                            <select x-model="setting.startAt">
                                <template x-for="type in [{name:'白天', value:'day'}, {name:'夜晚', value:'night'}, {name:'白天（无处刑）', value:'day/No-Lynch'}]" :key="type.value">
                                    <option x-text="type.name" :value="type.value" :selected="type.value === setting.startAt"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label>死亡后揭示玩家角色</label>
                            <input type="checkbox" x-model="setting.revealPlayerRoleOnDeath" />
                        </div>
                        <div>
                            <label>启用自设名字</label>
                            <input type="checkbox" x-model="setting.enableCustomName" />
                        </div>
                        <div>
                            <label>启用遗嘱</label>
                            <input type="checkbox" x-model="setting.enableLastWord" />
                        </div>
                        <div>
                            <label>启用击杀留言</label>
                            <input type="checkbox" x-model="setting.enableKillMessage" />
                        </div>
                        <div>
                            <label>启用私信</label>
                            <input type="checkbox" x-model="setting.enablePrivateMessage" />
                        </div>
                        
                    </div>
                    <div>
                        <h4>白天设置</h4>
                        <div>
                            <span>白天投票类型</span>
                            <select x-model="setting.dayVoteType" disabled>
                                <template x-for="voteType in [{name:'实名过半数', value:'Majority'}, {name:'匿名最高票', value:'Ballot'}]" :key="voteType.name">
                                    <option x-text="voteType.name" :value="voteType.value" :selected="voteType.value === setting.dayVoteType"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label>白天时长</label>
                            <input type="range" min="0.1" max="5" step="0.1" x-model="setting.dayLength" />
                            <!-- <input type="text"  min="0.1" max="5" step="0.1" x-model="setting.dayLength" />
                            <span>分钟</span> -->
                            <span x-text="`${Number(setting?.dayLength).toFixed(1)} 分钟`"></span>
                        </div>
                        <span>
                            <label>启用讨论</label>
                            <input type="checkbox" x-model="setting.enableDiscussion" />
                        </span>
                        <span>
                            <label>启用审判</label>
                            <input type="checkbox" x-model="setting.enableTrial" />
                        </span>
                        <div x-show="setting.enableDiscussion" x-transition>
                            <h5>讨论设置</h5>
                            <div>
                                <label>讨论时长</label>
                                <input type="range" min="0.1" max="5" step="0.1" x-model="setting.discussionTime" />
                                <!-- <input type="text"  min="0.1" max="5" step="0.1" x-model="setting.discussionTime" />
                                <span>分钟</span> -->
                                <span x-text="`${Number(setting?.discussionTime).toFixed(1)} 分钟`"></span>
                            </div>
                        </div>
                        <div x-show="setting.enableTrial" x-transition>
                            <h5>审判设置</h5>
                            <div>
                                <label>审判时长</label>
                                <input type="range" min="0.1" max="5" step="0.1" x-model="setting.trialTime" />
                                <!-- <input type="text"  min="0.1" max="5" step="0.1" x-model="setting.trialTime" />
                                <span>分钟</span> -->
                                <span x-text="`${Number(setting?.trialTime).toFixed(1)} 分钟`"></span>
                            </div>
                            <span>
                                <label>审判时暂停白天</label>
                                <input type="checkbox" x-model="setting.pauseDayTimerDuringTrial" disabled/>
                            </span>
                            <span>
                                <label>启用辩护</label>
                                <input type="checkbox" x-model="setting.enableTrialDefense" />
                            </span>
                        </div>
                    </div>
                    <div>
                        <h4>夜晚设置</h4>
                        <div>
                            <span>夜晚信息类型</span>
                            <select x-model="setting.nightType" disabled>
                                <template x-for="nighType in [{name:'经典', value:'Classic'}]" :key="nighType.name">
                                    <option x-text="nighType.name" :value="nighType.value" :selected="nighType.value === setting.nightType"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label>夜晚时长</label>
                            <input type="range" min="0.1" max="5" step="0.1" x-model="setting.nightLength" />
                            <!-- <input type="text"  min="0.1" max="5" step="0.1" x-model="setting.nightLength" />
                            <span>分钟</span> -->
                            <span x-text="`${Number(setting?.nightLength).toFixed(1)} 分钟`"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="settingPageInnerBody">
                <div id="settingPageInnerBodyLeftBar">
                    <div>
                        <div style="display: flex;">
                            <div id="presetBar" class="border scrollbar">
                                <h3 class="boxLabel">预设栏</h3>
                                <template x-for="preset in presets" :key="preset.name">
                                    <span x-html="preset.name" @click="selectPreset(preset)" class="presetButton" :class="selectedPreset === preset ? 'selected':'' "></span>
                                </template>
                            </div>
                            <div id="presetIntroduction" x-show="selectedPreset" style="position: relative;" x-transition>
                                <h3 class="boxLabel" x-text="selectedPreset?.name"></h3>
                                <p x-text="selectedPreset?.description"></p>
                            </div>
                        </div>

                        <div id="presetButtonBar" class="buttonBar">
                            <button @click="useSelectedPreset">采用</button>
                            <!-- <button @click="saveSelectedPreset">保存</button>
                            <button @click="deleteSelectedPreset">删除</button> -->
                            <button @click="importSetting">导入</button>
                            <button @click="exportSetting">导出</button>
                        </div>
                    </div>

                    <div id="chatAndUserList">
                        <div class="chatForm border">
                            <div class="chatMessageList scrollbar">
                                <!-- <table>
                                    <template x-for="message in messageList">
                                        <tr>
                                            <th x-text="`${message.senderName}:`"></th>
                                            <td x-text="message.message"></td>
                                        </tr>
                                    </template>
                                </table> -->
                                <p style="color:YellowGreen;background-color: rgba(0, 0, 0, 0.1);">你好，欢迎体验星际2黑手党网页版的...抢先体验版！<br/>
                                    如果您在游玩过程中发现了bug，或是有任何意见、建议，<br/>
                                    请加入QQ群：256373733 或是在 <a href="https://github.com/Nivdc/lobby" target="_blank">项目主页</a> 反馈。<br>
                                    <br>
                                    祝您游戏愉快。
                                </p>
                                <template x-for="message in messageList">
                                    <p :style="message.style" :class="message.class">
                                        <template x-for="messagePart in message.parts">
                                            <span x-text="messagePart.text" :style="messagePart.style" :class="messagePart.class"></span>
                                        </template>
                                    </p>
                                </template>
                            </div>
                            <form class="formTextInput" @submit.prevent="submit">
                                <input type="text"  x-model="inputString"/>
                            </form>
                        </div>
                    </div>
                </div>

                <div id="settingPageInnerBodyMiddle">
                    <p><span :style="`font-size:1.5em;font-weight: bold;text-decoration:underline;color:${host?.color}`" x-text="`${host?.index+1}.${host?.name}`">测试</span><span>将会设置游戏</span></p>
                    <button @click="repickHost()">重选主机</button>
                </div>

                <div id="settingPageInnerBodyRightBar">
                    <div style="display: flex;flex:auto;margin-bottom: 2em;">
                        <div style="display: flex;flex-direction: column;position: relative;flex: auto;">
                            <h3 style="margin-bottom: 0.2em;flex: initial;">角色目录</h3>
                            <div style="display: flex;flex-direction: column;flex: auto;">
                                <div id="roleAffiliationSet" class="roleContainer">
                                    <template x-for="affiliation in affiliationSet" :key="affiliation.name">
                                        <span x-text="affiliation.nameZh??affiliation.name" :style="`color:${affiliation.color};background-color:${selectedAffiliation===affiliation? '#012845':'none'};`" @click="selectAffiliation(affiliation)"></span>
                                    </template>
                                </div>
                                <div id="roleSet" x-show="selectedAffiliation" class="roleContainer" x-transition>
                                    <template x-for="role in getRoleSetByAffiliationName(selectedAffiliation?.name)" :key="role.name">
                                        <span x-text="role.nameZh??role.name" :style="`color:${role.affiliation.color};background-color:${selectedRole===role? '#012845':'none'};`" @click="selectRole(role)"></span>
                                    </template>
                                </div>
                            </div>
                            <div id="roleDescriptionSection" x-show="selectedRole" x-transition>
                                <h3 x-text="selectedRole?.nameZh??selectedRole?.name" :style="`color:${selectedRole?.affiliation.color}`"></h3>
                                <p x-text="selectedRole?.descriptionZh??selectedRole?.description" style="color:var(--optional-emphasized-content)"></p>
                                <p x-text="selectedRole?.abilityDescriptionZh??selectedRole?.abilityDescription" style="color:deepskyblue"></p>
                                <p x-show="selectedRole?.otherDescriptionZh" x-text="selectedRole?.otherDescriptionZh??selectedRole?.otherDescription"></p>
                            </div>
                        </div>
                        <div id="roleSettingButtonBar">
                            <button @click="addSelectedRole()">添加</button>
                            <button @click="removeSelectedRole()">移除</button>
                            <!-- <button>禁用</button>
                            <button>恢复</button> -->
                        </div>
                        <div style="display:flex;flex: auto;flex-direction: column;">
                            <h3 style="margin-bottom: 0.2em;flex: initial;">角色列表</h3>
                            <div id="roleList" class="roleContainer scrollbar">
                                <template x-for="role in getRoleListFromData(setting.roleList)">
                                    <span x-text="role.nameZh??role.name" :style="`color:${role.affiliation.color};background-color:${selectedRole===role? '#012845':'none'};`" @click="selectRole(role)"></span>
                                </template>
                            </div>
                            <!-- <h3 style="margin-bottom: 0.2em;flex: initial;">禁用列表</h3>
                            <div id="roleList" class="roleContainer">
                                <template x-for="role in getRoleListFromData(setting.bannedRoleList)">
                                    <span x-text="role.nameZh??role.name" :style="`color:${role.affiliation.color};background-color:${selectedRole===role? '#012845':'none'};`" @click="selectRole(role)"></span>
                                </template>
                            </div> -->
                        </div>
                    </div>

                    <div style="display: flex; flex-direction: row-reverse;">
                        <div id="startInfoAndButton">
                            <p x-text="startInfo">测试信息</p>
                            <button id="startButton" x-text="startButtonToggle ? '开始':'取消' " @click="start()" :class="startButtonToggle ? 'background-success background-success-hover':'background-danger background-danger-hover'">开始</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
